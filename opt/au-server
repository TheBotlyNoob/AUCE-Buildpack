#!/usr/bin/env bash

serverport=22023
port=${1:-${PORT:-8080}}

# Start the TCP tunnel
echo "Starting: LocalTunnel..."
eval "npx localtunnel -p $serverport | tee tunnel.log &"
tunnel_pid=$!

cd bin
echo "Starting: The Server At Port ${serverport}"
eval "screen -h 2048 -dmS server Server/Impostor.Server | tee server.log"
main_pid=$!

trap "kill $tunnel_pid $main_pid $tail_pid" EXIT
npx http-server -p $port